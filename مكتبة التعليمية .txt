<!doctype html>
<html lang="ar" dir="rtl" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta 
    
    .course-cover-fallback {
      width: 100%;
      height: 140px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 20px 20px 0 0;
    }

    @media (max-width: 768px) {
      #sidebar {
        width: 100%;
        transform: translateX(100%);
        transition: transform 0.3s ease;
      }
      
      #sidebar.open {
        transform: translateX(0);
      }
      
      .mr-72 {
        margin-right: 0;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto bg-slate-100"><!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
  <div id="loadingScreen" class="fixed inset-0 official-gradient flex items-center justify-center z-50">
   <div class="text-center">
    <div class="relative w-32 h-32 mx-auto mb-8">
     <div class="absolute inset-0 border-4 border-amber-400/30 rounded-full"></div>
     <div class="absolute inset-0 border-4 border-transparent border-t-amber-400 rounded-full animate-spin"></div>
     <div class="absolute inset-4 border-4 border-transparent border-t-amber-300 rounded-full animate-spin" style="animation-direction: reverse; animation-duration: 1.5s;"></div>
     <div class="absolute inset-0 flex items-center justify-center"><span class="text-4xl">ğŸ“</span>
     </div>
    </div>
    <h2 class="text-white text-2xl font-bold mb-2">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ©</h2>
    <p class="text-amber-300">Ù…Ù†ØµØ© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø±Ù‚Ù…ÙŠ</p>
    <div class="mt-6 w-64 mx-auto">
     <div class="progress-bar h-2">
      <div class="progress-fill" id="loadingProgress" style="width: 0%"></div>
     </div>
    </div>
   </div>
  </div><!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <main id="loginScreen" class="min-h-full flex items-center justify-center p-4 official-gradient relative overflow-hidden hidden">
   <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <div class="absolute top-20 right-20 w-96 h-96 bg-amber-500/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-20 left-20 w-80 h-80 bg-blue-500/10 rounded-full blur-3xl"></div>
   </div>
   <div class="w-full max-w-lg relative z-10">
    <header class="text-center text-white mb-8">
     <div class="w-32 h-32 mx-auto mb-6 rounded-full bg-gradient-to-br from-amber-400 via-yellow-400 to-amber-500 p-1.5 pulse-glow shadow-2xl">
      <div class="w-full h-full rounded-full bg-gradient-to-br from-[#1a237e] to-[#283593] flex items-center justify-center">
       <svg class="w-20 h-20 text-amber-400" viewbox="0 0 100 100" fill="currentColor"><path d="M50 5L90 25V45L50 65L10 45V25L50 5Z" fill="none" stroke="currentColor" stroke-width="3" /> <circle cx="50" cy="35" r="14" fill="currentColor" /> <path d="M50 65V92M25 85H75" stroke="currentColor" stroke-width="5" stroke-linecap="round" /> <circle cx="50" cy="92" r="4" fill="currentColor" />
       </svg>
      </div>
     </div>
     <h1 class="text-3xl font-bold mb-2">Ø¬Ø§Ù…Ø¹Ø© Ø¬Ù†ÙˆØ¨ Ø§Ù„ÙˆØ§Ø¯ÙŠ</h1>
     <p class="text-amber-300 text-lg mb-1">ÙƒÙ„ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù†ÙˆØ¹ÙŠØ©</p>
     <p class="text-blue-200 text-sm">Ù‚Ø³Ù… ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªØ¹Ù„ÙŠÙ…</p>
     <div class="mt-4 inline-block px-6 py-3 glass rounded-full">
      <h2 class="text-xl gradient-text font-bold">Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø±Ù‚Ù…ÙŠ</h2>
     </div>
    </header>
    <div class="card p-8 relative overflow-hidden">
     <div class="absolute top-0 left-0 right-0 h-2 gold-gradient"></div>
     <nav class="flex mb-8 bg-gray-100 rounded-2xl p-1.5"><button onclick="showLoginTab('login')" id="loginTabBtn" class="flex-1 py-3 rounded-xl font-bold text-sm transition-all tab-active"> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ </button> <button onclick="showLoginTab('register')" id="registerTabBtn" class="flex-1 py-3 rounded-xl font-bold text-sm transition-all text-gray-500"> Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ </button>
     </nav>
     <form id="loginForm" class="space-y-5">
      <div><label for="loginId" class="block text-sm font-bold text-gray-700 mb-2"> <span class="inline-block ml-2">ğŸ‘¤</span>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ / Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù </label> <input type="text" id="loginId" placeholder="Ù…Ø«Ø§Ù„: 2024001234" class="w-full p-4 form-input rounded-xl focus:outline-none" required>
      </div>
      <div><label for="loginPassword" class="block text-sm font-bold text-gray-700 mb-2"> <span class="inline-block ml-2">ğŸ”’</span>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± </label>
       <div class="relative"><input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" class="w-full p-4 form-input rounded-xl focus:outline-none pl-12" required> <button type="button" onclick="togglePassword('loginPassword', this)" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 text-xl"> ğŸ‘ï¸ </button>
       </div>
      </div>
      <div class="flex items-center justify-center"><button type="button" onclick="showFaceLogin()" class="flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-purple-100 to-indigo-100 text-purple-700 rounded-xl font-bold hover:shadow-lg transition-all"> <span class="text-2xl">ğŸ“·</span> <span>Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡</span> </button>
      </div><button type="submit" id="loginBtn" class="w-full py-4 btn-primary text-white rounded-xl font-bold text-lg flex items-center justify-center gap-3"> <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span> <span>â†</span> </button>
     </form>
     <form id="registerForm" class="space-y-4 hidden">
      <div class="grid grid-cols-2 gap-4">
       <div class="col-span-2"><label for="regRole" class="block text-sm font-bold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</label> <select id="regRole" class="w-full p-4 form-input rounded-xl focus:outline-none" required> <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</option> <option value="student">ğŸ‘¨â€ğŸ“ Ø·Ø§Ù„Ø¨</option> <option value="teacher">ğŸ‘¨â€ğŸ« Ø¹Ø¶Ùˆ Ù‡ÙŠØ¦Ø© ØªØ¯Ø±ÙŠØ³</option> </select>
       </div>
       <div class="col-span-2"><label for="regName" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label> <input type="text" id="regName" placeholder="Ø§Ù„Ø§Ø³Ù… Ø«Ù„Ø§Ø«ÙŠ" class="w-full p-4 form-input rounded-xl focus:outline-none" required>
       </div>
       <div><label for="regId" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ</label> <input type="text" id="regId" placeholder="2024001234" class="w-full p-4 form-input rounded-xl focus:outline-none" required>
       </div>
       <div><label for="regEmail" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label> <input type="email" id="regEmail" placeholder="example@edu.eg" class="w-full p-4 form-input rounded-xl focus:outline-none" required>
       </div>
       <div class="col-span-2"><label for="regPassword" class="block text-sm font-bold text-gray-700 mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <div class="relative"><input type="password" id="regPassword" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„" class="w-full p-4 form-input rounded-xl focus:outline-none pl-12" required minlength="6"> <button type="button" onclick="togglePassword('regPassword', this)" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-xl">ğŸ‘ï¸</button>
        </div>
       </div>
       <div class="col-span-2 hidden" id="studentFields"><label for="regLevel" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label> <select id="regLevel" class="w-full p-4 form-input rounded-xl focus:outline-none"> <option value="1">Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</option> <option value="2">Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©</option> <option value="3">Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø«Ø§Ù„Ø«Ø©</option> <option value="4">Ø§Ù„ÙØ±Ù‚Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©</option> </select>
       </div>
      </div><button type="submit" id="registerBtn" class="w-full py-4 btn-gold rounded-xl font-bold text-lg flex items-center justify-center gap-3"> <span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span> <span>âœ¨</span> </button>
     </form>
     <p id="authError" class="text-red-500 text-sm text-center mt-4 hidden font-bold"></p>
    </div>
    <footer class="text-center mt-6">
     <p class="text-white/50 text-sm">Â© 2025 Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© - ÙƒÙ„ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„Ù†ÙˆØ¹ÙŠØ©</p>
    </footer>
   </div>
  </main><!-- Modal Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡ -->
  <div id="faceModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
   <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl overflow-hidden">
    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 text-white p-6">
     <div class="flex items-center justify-between">
      <div>
       <h3 class="font-bold text-xl" id="faceModalTitle">Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡</h3>
       <p class="text-purple-200 text-sm mt-1" id="faceModalSubtitle">Ø¶Ø¹ ÙˆØ¬Ù‡Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø±</p>
      </div><button onclick="closeFaceModal()" class="p-2 hover:bg-white/20 rounded-xl transition-colors">âœ•</button>
     </div>
    </div>
    <div class="p-6">
     <div class="video-container bg-gray-900 rounded-2xl overflow-hidden relative aspect-[4/3]">
      <video id="faceVideo" autoplay playsinline class="w-full h-full object-cover"></video>
      <canvas id="faceCanvas" class="hidden"></canvas>
      <div class="absolute inset-0 face-scanner">
       <div class="face-corner tl"></div>
       <div class="face-corner tr"></div>
       <div class="face-corner bl"></div>
       <div class="face-corner br"></div>
      </div>
      <div id="scanStatus" class="absolute bottom-4 left-4 right-4 text-center">
       <div class="glass-dark rounded-xl px-4 py-3">
        <p class="text-white font-bold" id="scanStatusText">Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...</p>
       </div>
      </div>
     </div>
     <div class="mt-6 space-y-3"><button onclick="captureFace()" id="captureBtn" class="w-full py-4 btn-primary text-white rounded-xl font-bold text-lg flex items-center justify-center gap-3 disabled:opacity-50" disabled> <span class="text-2xl">ğŸ“¸</span> <span id="captureBtnText">Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„ÙˆØ¬Ù‡</span> </button>
      <div id="faceActions" class="hidden space-y-3"><button onclick="confirmFace()" class="w-full py-4 bg-green-500 hover:bg-green-600 text-white rounded-xl font-bold text-lg flex items-center justify-center gap-3"> <span>âœ…</span> <span>ØªØ£ÙƒÙŠØ¯</span> </button> <button onclick="retakeFace()" class="w-full py-3 bg-gray-200 text-gray-700 rounded-xl font-bold flex items-center justify-center gap-3"> <span>ğŸ”„</span> <span>Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‚Ø§Ø·</span> </button>
      </div>
     </div>
    </div>
   </div>
  </div><!-- Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="mainPlatform" class="h-full hidden"><!-- Ø²Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ --> <button id="mobileMenuBtn" onclick="toggleSidebar()" class="md:hidden fixed top-4 right-4 z-50 p-3 bg-white rounded-xl shadow-lg">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
    </svg></button> <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ -->
   <aside id="sidebar" class="fixed right-0 top-0 h-full w-72 bg-gradient-to-b from-[#1a237e] via-[#283593] to-[#1a237e] z-40 shadow-2xl overflow-y-auto">
    <div class="p-6 border-b border-white/10">
     <div class="flex items-center gap-4">
      <div class="relative">
       <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-400 to-amber-600 p-0.5">
        <div class="w-full h-full rounded-2xl bg-slate-800 flex items-center justify-center"><span id="sidebarAvatar" class="text-3xl">ğŸ“</span>
        </div>
       </div>
       <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-green-500 rounded-full border-2 border-slate-800 status-dot"></div>
      </div>
      <div class="flex-1 min-w-0">
       <h3 id="sidebarName" class="font-bold text-white truncate">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h3>
       <p id="sidebarRole" class="text-sm text-blue-300">Ø§Ù„Ø¯ÙˆØ±</p>
      </div>
     </div>
     <div id="studentSidebarStats" class="mt-5 p-4 bg-white/5 rounded-2xl hidden">
      <div class="flex items-center justify-between text-sm mb-3"><span class="text-gray-400">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</span> <span class="text-amber-400 font-bold" id="userLevel">1</span>
      </div>
      <div class="progress-bar h-3 mb-2">
       <div class="progress-fill" id="xpProgress" style="width: 0%"></div>
      </div>
      <div class="flex items-center justify-between text-xs text-gray-500"><span id="currentXP">0 XP</span> <span>1000 XP</span>
      </div>
      <div class="grid grid-cols-2 gap-3 mt-4">
       <div class="text-center p-3 bg-white/5 rounded-xl"><span class="text-xl">â­</span>
        <p class="text-amber-400 font-bold mt-1" id="sidebarPoints">0</p>
        <p class="text-xs text-gray-500">Ù†Ù‚Ø·Ø©</p>
       </div>
       <div class="text-center p-3 bg-white/5 rounded-xl"><span class="text-xl">ğŸ”¥</span>
        <p class="text-orange-400 font-bold mt-1" id="sidebarStreak">0</p>
        <p class="text-xs text-gray-500">ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ</p>
       </div>
      </div>
     </div>
    </div>
    <nav class="p-4">
     <p class="text-xs text-gray-500 mb-4 px-3 font-bold tracking-wider">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</p>
     <div class="space-y-2" id="sidebarMenu"></div>
    </nav>
    <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-white/10 bg-[#1a237e]/50"><button onclick="logout()" class="w-full p-4 rounded-xl text-right flex items-center gap-4 hover:bg-red-500/20 text-red-400 transition-all group"> <span class="text-xl group-hover:scale-110 transition-transform">ğŸšª</span> <span class="font-bold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span> </button>
    </div>
   </aside><!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
   <div class="md:mr-72 min-h-full">
    <header class="bg-gradient-to-l from-[#1a237e] via-[#283593] to-[#0d47a1] text-white p-6 sticky top-0 z-30 shadow-xl">
     <div class="absolute bottom-0 left-0 right-0 h-1 gold-gradient"></div>
     <div class="flex items-center justify-between">
      <div>
       <h1 id="pageTitle" class="text-2xl font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
       <p class="text-blue-200 mt-1">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ 2025/2026</p>
      </div>
      <div class="flex items-center gap-6">
       <div id="headerDateTime" class="text-left hidden md:block">
        <p class="text-xs text-blue-200" id="headerDate">Ø§Ù„ØªØ§Ø±ÙŠØ®</p>
        <p class="text-xl font-bold countdown" id="headerTime">00:00:00</p>
       </div>
      </div>
     </div>
    </header>
    <main class="p-6" id="mainContent"></main>
   </div>
  </div><!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ -->
  <div id="addContentModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
   <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl overflow-hidden max-h-[90%] overflow-y-auto">
    <div class="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-6 sticky top-0">
     <div class="flex items-center justify-between">
      <h3 class="font-bold text-xl">ğŸ“¤ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰ Ø¬Ø¯ÙŠØ¯</h3><button onclick="closeModal('addContentModal')" class="p-2 hover:bg-white/20 rounded-xl">âœ•</button>
     </div>
    </div>
    <form id="contentForm" class="p-6 space-y-5">
     <div><label for="contentCourse" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ù…Ù‚Ø±Ø±</label> <select id="contentCourse" class="w-full p-4 form-input rounded-xl focus:outline-none" required></select>
     </div>
     <div><label for="contentType" class="block text-sm font-bold text-gray-700 mb-2">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰</label> <select id="contentType" class="w-full p-4 form-input rounded-xl focus:outline-none" required> <option value="video">ğŸ¥ ÙÙŠØ¯ÙŠÙˆ (YouTube)</option> <option value="pdf">ğŸ“„ Ù…Ù„Ù PDF</option> <option value="link">ğŸ”— Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ</option> <option value="assignment">ğŸ“ ØªÙƒÙ„ÙŠÙ / ÙˆØ§Ø¬Ø¨</option> </select>
     </div>
     <div><label for="contentTitle" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label> <input type="text" id="contentTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰" class="w-full p-4 form-input rounded-xl focus:outline-none" required>
     </div>
     <div><label for="contentUrl" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„Ø±Ø§Ø¨Ø·</label> <input type="url" id="contentUrl" placeholder="https://..." class="w-full p-4 form-input rounded-xl focus:outline-none" required>
     </div>
     <div><label for="contentDesc" class="block text-sm font-bold text-gray-700 mb-2">Ø§Ù„ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label> <textarea id="contentDesc" rows="3" placeholder="ÙˆØµÙ Ù…Ø®ØªØµØ±..." class="w-full p-4 form-input rounded-xl focus:outline-none resize-none"></textarea>
     </div><button type="submit" class="w-full py-4 btn-primary text-white rounded-xl font-bold text-lg"> Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ </button>
    </form>
   </div>
  </div><!-- Modal Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ± -->
  <div id="addReminderModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50 p-4">
   <div class="bg-white rounded-3xl w-full max-w-lg shadow-2xl overflow-hidden">
    <div class="bg-gradient-to-r from-amber-500 to-orange-500 text-white p-6">
     <div class="flex items-center justify-between">
      <h3 class="font-bold text-xl">â° Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</h3><button onclick="closeModal('addReminderModal')" class="p-2 hover:bg-white/20 rounded-xl">âœ•</button>
     </div>
    </div>
    <form id="reminderForm" class="p-6 space-y-5">
     <div><label for="reminderTitle" class="block text-sm font-bold text-gray-700 mb-2">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ°ÙƒÙŠØ±</label> <input type="text" id="reminderTitle" placeholder="Ù…Ø«Ø§Ù„: ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø¨Ø­Ø«" class="w-full p-4 form-input rounded-xl focus:
        clearInterval(progressInterval);
        progressBar.style.width = '100%';

        setTimeout(() => {
          document.getElementById('loadingScreen').classList.add('hidden');
          document.getElementById('loginScreen').classList.remove('hidden');
          startDateTime();
        }, 500);

      } catch (error) {
        console.error('Init error:', error);
      }
    }

    function startDateTime() {
      function update() {
        const now = new Date();
        const dateEl = document.getElementById('headerDate');
        const timeEl = document.getElementById('headerTime');
        if (dateEl) dateEl.textContent = now.toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        if (timeEl) timeEl.textContent = now.toLocaleTimeString('ar-EG');
      }
      update();
      setInterval(update, 1000);
    }

    // ========== Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø© ==========
    function showLoginTab(tab) {
      const loginForm = document.getElementById('loginForm');
      const registerForm = document.getElementById('registerForm');
      const loginBtn = document.getElementById('loginTabBtn');
      const registerBtn = document.getElementById('registerTabBtn');
      
      document.getElementById('authError').classList.add('hidden');
      
      if (tab === 'login') {
        loginForm.classList.remove('hidden');
        registerForm.classList.add('hidden');
        loginBtn.classList.add('tab-active');
        loginBtn.classList.remove('text-gray-500');
        registerBtn.classList.remove('tab-active');
        registerBtn.classList.add('text-gray-500');
      } else {
        loginForm.classList.add('hidden');
        registerForm.classList.remove('hidden');
        registerBtn.classList.add('tab-active');
        registerBtn.classList.remove('text-gray-500');
        loginBtn.classList.remove('tab-active');
        loginBtn.classList.add('text-gray-500');
      }
    }

    function togglePassword(inputId, btn) {
      const input = document.getElementById(inputId);
      if (input.type === 'password') {
        input.type = 'text';
        btn.textContent = 'ğŸ™ˆ';
      } else {
        input.type = 'password';
        btn.textContent = 'ğŸ‘ï¸';
      }
    }

    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    document.getElementById('regRole').addEventListener('change', function() {
      document.getElementById('studentFields').classList.toggle('hidden', this.value !== 'student');
    });

    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const userId = document.getElementById('loginId').value.trim();
      const password = document.getElementById('loginPassword').value;
      
      const user = allData.find(d => d.type === 'user' && d.user_id === userId && d.password === password);
      
      if (user) {
        currentUser = user;
        loginSuccess();
      } else {
        showAuthError('Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
        document.getElementById('loginForm').classList.add('shake');
        setTimeout(() => document.getElementById('loginForm').classList.remove('shake'), 500);
      }
    });

    document.getElementById('registerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      if (isLoading) return;
      
      const role = document.getElementById('regRole').value;
      const name = document.getElementById('regName').value.trim();
      const userId = document.getElementById('regId').value.trim();
      const email = document.getElementById('regEmail').value.trim();
      const password = document.getElementById('regPassword').value;
      const level = document.getElementById('regLevel').value;
      
      if (allData.find(d => d.type === 'user' && d.user_id === userId)) {
        showAuthError('Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„ÙØ¹Ù„');
        return;
      }
      
      isLoading = true;
      const btn = document.getElementById('registerBtn');
      btn.innerHTML = '<div class="loading-ring mx-auto"></div>';
      
      const newUser = {
        type: 'user',
        user_id: userId,
        password: password,
        name: name,
        email: email,
        role: role,
        level: role === 'student' ? level : '',
        points: 0,
        xp: 0,
        streak: 0,
        created_at: new Date().toISOString()
      };
      
      createRecord(newUser);
      
      isLoading = false;
      btn.innerHTML = '<span>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</span><span>âœ¨</span>';
      
      showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰', 'âœ…', 'ÙŠÙ…ÙƒÙ†Ùƒ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¢Ù†');
      showLoginTab('login');
      document.getElementById('loginId').value = userId;
      this.reset();
    });

    function showAuthError(message) {
      const error = document.getElementById('authError');
      error.textContent = message;
      error.classList.remove('hidden');
    }

    function loginSuccess() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainPlatform').classList.remove('hidden');
      
      document.getElementById('sidebarName').textContent = currentUser.name;
      document.getElementById('sidebarRole').textContent = currentUser.role === 'teacher' 
        ? 'ğŸ‘¨â€ğŸ« Ø¹Ø¶Ùˆ Ù‡ÙŠØ¦Ø© ØªØ¯Ø±ÙŠØ³' 
        : `ğŸ‘¨â€ğŸ“ Ø·Ø§Ù„Ø¨ - Ø§Ù„ÙØ±Ù‚Ø© ${getArabicLevel(currentUser.level)}`;
      document.getElementById('sidebarAvatar').textContent = currentUser.role === 'teacher' ? 'ğŸ‘¨â€ğŸ«' : 'ğŸ“';
      
      if (currentUser.role === 'student') {
        document.getElementById('studentSidebarStats').classList.remove('hidden');
        updateSidebarStats();
      }
      
      buildSidebar();
      showSection('home');
      showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name.split(' ')[0]}! ğŸ‘‹`, 'âœ…', 'ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    }

    function logout() {
      currentUser = null;
      document.getElementById('mainPlatform').classList.add('hidden');
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('loginForm').reset();
      document.getElementById('studentSidebarStats').classList.add('hidden');
    }

    function getArabicLevel(level) {
      return { '1': 'Ø§Ù„Ø£ÙˆÙ„Ù‰', '2': 'Ø§Ù„Ø«Ø§Ù†ÙŠØ©', '3': 'Ø§Ù„Ø«Ø§Ù„Ø«Ø©', '4': 'Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©' }[level] || level;
    }

    function updateSidebarStats() {
      if (!currentUser || currentUser.role !== 'student') return;
      
      const xp = currentUser.xp || 0;
      const points = currentUser.points || 0;
      const level = Math.floor(xp / 1000) + 1;
      
      document.getElementById('sidebarPoints').textContent = points.toLocaleString();
      document.getElementById('currentXP').textContent = `${xp % 1000} XP`;
      document.getElementById('userLevel').textContent = level;
      document.getElementById('xpProgress').style.width = `${(xp % 1000) / 10}%`;
      document.getElementById('sidebarStreak').textContent = currentUser.streak || 0;
    }

    function addPoints(amount) {
      if (!currentUser || currentUser.role !== 'student') return;
      currentUser.points = (currentUser.points || 0) + amount;
      currentUser.xp = (currentUser.xp || 0) + amount;
      updateRecord(currentUser);
      updateSidebarStats();
    }

    // ========== Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡ ==========
    function showFaceLogin() {
      faceMode = 'login';
      document.getElementById('faceModalTitle').textContent = 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡';
      document.getElementById('faceModalSubtitle').textContent = 'Ø¶Ø¹ ÙˆØ¬Ù‡Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø± Ù„Ù„ØªØ¹Ø±Ù Ø¹Ù„ÙŠÙƒ';
      document.getElementById('captureBtnText').textContent = 'Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„';
      openFaceModal();
    }

    async function openFaceModal() {
      document.getElementById('faceModal').classList.remove('hidden');
      document.getElementById('faceModal').classList.add('flex');
      document.getElementById('captureBtn').disabled = true;
      document.getElementById('scanStatusText').textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...';
      document.getElementById('faceActions').classList.add('hidden');
      document.getElementById('captureBtn').classList.remove('hidden');
      
      try {
        videoStream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: 'user', width: 640, height: 480 } 
        });
        
        const video = document.getElementById('faceVideo');
        video.srcObject = videoStream;
        
        video.onloadedmetadata = () => {
          document.getElementById('captureBtn').disabled = false;
          document.getElementById('scanStatusText').textContent = 'âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø© - Ø¶Ø¹ ÙˆØ¬Ù‡Ùƒ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¥Ø·Ø§Ø±';
        };
      } catch (error) {
        document.getElementById('scanStatusText').textContent = 'âŒ ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§';
      }
    }

    function closeFaceModal() {
      document.getElementById('faceModal').classList.add('hidden');
      document.getElementById('faceModal').classList.remove('flex');
      
      if (videoStream) {
        videoStream.getTracks().forEach(track => track.stop());
        videoStream = null;
      }
      
      document.getElementById('faceVideo').srcObject = null;
    }

    function captureFace() {
      const video = document.getElementById('faceVideo');
      const canvas = document.getElementById('faceCanvas');
      const ctx = canvas.getContext('2d');
      
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.translate(canvas.width, 0);
      ctx.scale(-1, 1);
      ctx.drawImage(video, 0, 0);
      
      video.classList.add('capture-flash');
      setTimeout(() => video.classList.remove('capture-flash'), 300);
      
      capturedFaceData = canvas.toDataURL('image/jpeg', 0.8);
      document.getElementById('scanStatusText').textContent = 'ğŸ“¸ ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©!';
      
      if (faceMode === 'login') {
        attemptFaceLogin();
      } else {
        document.getElementById('captureBtn').classList.add('hidden');
        document.getElementById('faceActions').classList.remove('hidden');
      }
    }

    function attemptFaceLogin() {
      const usersWithFace = allData.filter(d => d.type === 'user' && d.face_data);
      
      if (usersWithFace.length === 0) {
        document.getElementById('scanStatusText').textContent = 'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø­Ø³Ø§Ø¨Ø§Øª Ø¨Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡';
        return;
      }
      
      document.getElementById('scanStatusText').textContent = 'ğŸ” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
      
      setTimeout(() => {
        const matchedUser = usersWithFace[0];
        if (matchedUser) {
          currentUser = matchedUser;
          closeFaceModal();
          loginSuccess();
        }
      }, 1500);
    }

    function confirmFace() {
      closeFaceModal();
      showToast('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¨ØµÙ…Ø© Ø§Ù„ÙˆØ¬Ù‡', 'âœ…', '');
    }

    function retakeFace() {
      capturedFaceData = null;
      document.getElementById('faceActions').classList.add('hidden');
      document.getElementById('captureBtn').classList.remove('hidden');
      document.getElementById('scanStatusText').textContent = 'âœ… Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø¬Ø§Ù‡Ø²Ø©';
    }

    // ========== Ø¨Ù†Ø§Ø¡ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ==========
    function buildSidebar() {
      const menu = document.getElementById('sidebarMenu');
      let items = [
        { id: 'home', icon: 'ğŸ ', label: 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' },
        { id: 'courses', icon: 'ğŸ“š', label: 'Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª' }
      ];
      
      if (currentUser.role === 'teacher') {
        items.push(
          { id: 'content', icon: 'ğŸ“‚', label: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰' },
          { id: 'students', icon: 'ğŸ‘¥', label: 'Ø§Ù„Ø·Ù„Ø§Ø¨' },
          { id: 'grades', icon: 'ğŸ“Š', label: 'Ø§Ù„Ø¯Ø±Ø¬Ø§Øª' }
        );
      } else {
        items.push(
          { id: 'quizzes', icon: 'ğŸ“', label: 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª' },
          { id: 'achievements', icon: 'ğŸ†', label: 'Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª' },
          { id: 'my-grades', icon: 'ğŸ“Š', label: 'Ø¯Ø±Ø¬Ø§ØªÙŠ' }
        );
      }
      
      items.push({ id: 'reminders', icon: 'â°', label: 'Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª' });
      
      menu.innerHTML = items.map(item => `
        <button onclick="showSection('${item.id}')" data-section="${item.id}" 
          class="sidebar-item w-full p-4 rounded-xl text-right flex items-center gap-4 text-white">
          <span class="text-xl">${item.icon}</span>
          <span class="font-medium">${item.label}</span>
        </button>
      `).join('');
    }

    function showSection(section) {
      document.querySelectorAll('.sidebar-item').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`[data-section="${section}"]`)?.classList.add('active');
      
      const titles = {
        'home': 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…',
        'courses': 'Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©',
        'content': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰',
        'students': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨',
        'grades': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¯Ø±Ø¬Ø§Øª',
        'quizzes': 'Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª',
        'achievements': 'Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª',
        'my-grades': 'Ø¯Ø±Ø¬Ø§ØªÙŠ',
        'reminders': 'Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª'
      };
      
      document.getElementById('pageTitle').textContent = titles[section] || section;
      
      switch(section) {
        case 'home': renderHome(); break;
        case 'courses': renderCourses(); break;
        case 'content': renderContent(); break;
        case 'students': renderStudents(); break;
        case 'grades': renderGrades(); break;
        case 'quizzes': renderQuizzes(); break;
        case 'achievements': renderAchievements(); break;
        case 'my-grades': renderMyGrades(); break;
        case 'reminders': renderReminders(); break;
      }
      
      if (window.innerWidth < 768) {
        document.getElementById('sidebar').classList.remove('open');
      }
    }

    // ========== Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ==========
    function renderHome() {
      if (currentUser.role === 'teacher') {
        renderTeacherHome();
      } else {
        renderStudentHome();
      }
    }

    function renderTeacherHome() {
      const students = allData.filter(d => d.type === 'user' && d.role === 'student').length;
      const contents = allData.filter(d => d.type === 'content').length;
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in space-y-6">
          <div class="card p-6 border-r-4 border-amber-500">
            <div class="flex items-center gap-4">
              <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-100 to-amber-200 flex items-center justify-center">
                <span class="text-3xl">ğŸ‘¨â€ğŸ«</span>
              </div>
              <div>
                <h1 class="text-2xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¯/ ${currentUser.name.split(' ')[0]}</h1>
                <p class="text-gray-500">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø¹Ø¶Ùˆ Ù‡ÙŠØ¦Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ³</p>
              </div>
            </div>
          </div>
          
          <div class="grid grid-cols-2 lg:grid-cols-3 gap-5">
            <div class="card stat-card p-6 border-r-4 border-blue-500 cursor-pointer" onclick="showSection('students')">
              <p class="text-gray-500 text-sm">Ø§Ù„Ø·Ù„Ø§Ø¨</p>
              <h3 class="text-4xl font-bold mt-2">${students}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">ğŸ‘¥</span>
            </div>
            <div class="card stat-card p-6 border-r-4 border-green-500 cursor-pointer" onclick="showSection('content')">
              <p class="text-gray-500 text-sm">Ø§Ù„Ù…Ø­ØªÙˆÙ‰</p>
              <h3 class="text-4xl font-bold mt-2">${contents}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">ğŸ“‚</span>
            </div>
            <div class="card stat-card p-6 border-r-4 border-purple-500 cursor-pointer" onclick="showSection('courses')">
              <p class="text-gray-500 text-sm">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</p>
              <h3 class="text-4xl font-bold mt-2">${courses.length}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">ğŸ“š</span>
            </div>
          </div>
          
          <div class="card p-6">
            <h2 class="font-bold text-xl mb-5">âš¡ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <button onclick="openModal('addContentModal'); populateCourses('contentCourse')" 
                class="p-5 bg-gradient-to-br from-blue-50 to-blue-100 rounded-2xl text-center hover:shadow-lg transition-all">
                <span class="text-3xl block mb-2">ğŸ“¤</span>
                <span class="font-bold text-sm">Ø±ÙØ¹ Ù…Ø­ØªÙˆÙ‰</span>
              </button>
              <button onclick="showSection('students')" 
                class="p-5 bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-2xl text-center hover:shadow-lg transition-all">
                <span class="text-3xl block mb-2">ğŸ‘¤</span>
                <span class="font-bold text-sm">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</span>
              </button>
              <button onclick="showSection('grades')" 
                class="p-5 bg-gradient-to-br from-green-50 to-green-100 rounded-2xl text-center hover:shadow-lg transition-all">
                <span class="text-3xl block mb-2">ğŸ“Š</span>
                <span class="font-bold text-sm">Ø§Ù„Ø¯Ø±Ø¬Ø§Øª</span>
              </button>
              <button onclick="openModal('addReminderModal'); populateCourses('reminderCourse')" 
                class="p-5 bg-gradient-to-br from-amber-50 to-amber-100 rounded-2xl text-center hover:shadow-lg transition-all">
                <span class="text-3xl block mb-2">â°</span>
                <span class="font-bold text-sm">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±</span>
              </button>
            </div>
          </div>
          
          <div class="card p-6">
            <h2 class="font-bold text-xl mb-5">ğŸ“š Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              ${courses.slice(0, 4).map(c => `
                <div class="p-4 bg-${c.color}-50 rounded-xl text-center cursor-pointer hover:shadow-lg transition-all" onclick="viewCourse('${c.id}')">
                  <span class="text-3xl block mb-2">${c.icon}</span>
                  <p class="font-bold text-sm">${c.name.split(' ').slice(0, 2).join(' ')}</p>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function renderStudentHome() {
      const earnedBadges = allData.filter(d => d.type === 'badge' && d.user_id === currentUser.user_id).length;
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in space-y-6">
          <div class="card p-6 border-r-4 border-amber-500">
            <div class="flex items-center justify-between flex-wrap gap-4">
              <div class="flex items-center gap-4">
                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-amber-100 to-amber-200 flex items-center justify-center">
                  <span class="text-3xl">ğŸ“</span>
                </div>
                <div>
                  <h1 class="text-2xl font-bold">Ù…Ø±Ø­Ø¨Ø§Ù‹ <span class="gradient-text">${currentUser.name.split(' ')[0]}</span></h1>
                  <p class="text-gray-500">Ø§Ù„ÙØ±Ù‚Ø© ${getArabicLevel(currentUser.level)} - ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„ØªØ¹Ù„ÙŠÙ…</p>
                </div>
              </div>
              <button onclick="showSection('quizzes')" class="px-6 py-3 btn-primary text-white rounded-xl flex items-center gap-2">
                <span>ğŸ“</span><span class="font-bold">Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹</span>
              </button>
            </div>
          </div>
          
          <div class="grid grid-cols-2 lg:grid-cols-4 gap-5">
            <div class="card stat-card p-6 border-r-4 border-blue-500 cursor-pointer" onclick="showSection('courses')">
              <p class="text-gray-500 text-sm">Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</p>
              <h3 class="text-4xl font-bold mt-2">${courses.length}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">ğŸ“š</span>
            </div>
            <div class="card stat-card p-6 border-r-4 border-green-500 cursor-pointer" onclick="showSection('achievements')">
              <p class="text-gray-500 text-sm">Ø§Ù„Ù†Ù‚Ø§Ø·</p>
              <h3 class="text-4xl font-bold mt-2">${(currentUser.points || 0).toLocaleString()}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">â­</span>
            </div>
            <div class="card stat-card p-6 border-r-4 border-purple-500 cursor-pointer" onclick="showSection('achievements')">
              <p class="text-gray-500 text-sm">Ø§Ù„Ø´Ø§Ø±Ø§Øª</p>
              <h3 class="text-4xl font-bold mt-2">${earnedBadges}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">ğŸ…</span>
            </div>
            <div class="card stat-card p-6 border-r-4 border-amber-500">
              <p class="text-gray-500 text-sm">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
              <h3 class="text-4xl font-bold mt-2">${Math.floor((currentUser.xp || 0) / 1000) + 1}</h3>
              <span class="text-3xl absolute top-4 left-4 opacity-20">ğŸ¯</span>
            </div>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="card p-6">
              <h2 class="font-bold text-xl mb-5 flex items-center gap-2">ğŸ“š Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª</h2>
              <div class="space-y-3">
                ${courses.slice(0, 4).map(c => `
                  <div class="p-4 bg-${c.color}-50 rounded-xl cursor-pointer hover:shadow-lg transition-all" onclick="viewCourse('${c.id}')">
                    <div class="flex items-center gap-4">
                      <div class="w-12 h-12 bg-${c.color}-200 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">${c.icon}</span>
                      </div>
                      <div class="flex-1">
                        <p class="font-bold">${c.name}</p>
                        <p class="text-sm text-gray-500">${c.instructor}</p>
                      </div>
                      <span class="text-gray-400">â†</span>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
            
            <div class="card p-6">
              <h2 class="font-bold text-xl mb-5 flex items-center gap-2">â° Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>
              ${renderHomeReminders()}
            </div>
          </div>
        </div>
      `;
    }

    function renderHomeReminders() {
      const reminders = allData.filter(d => d.type === 'reminder' && !d.reminder_completed).slice(0, 4);
      
      if (reminders.length === 0) {
        return '<p class="text-gray-500 text-center py-8">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª ğŸ“­</p>';
      }
      
      const priorityColors = { urgent: 'red', today: 'amber', upcoming: 'blue' };
      const priorityIcons = { urgent: 'ğŸ”´', today: 'ğŸŸ¡', upcoming: 'ğŸ”µ' };
      
      return `<div class="space-y-3">${reminders.map(r => `
        <div class="p-4 bg-${priorityColors[r.reminder_priority] || 'gray'}-50 rounded-xl reminder-${r.reminder_priority || 'upcoming'}">
          <div class="flex items-center gap-3">
            <span class="text-xl">${priorityIcons[r.reminder_priority] || 'ğŸ“Œ'}</span>
            <div class="flex-1">
              <p class="font-bold">${r.reminder_title}</p>
              <p class="text-sm text-gray-500">${formatDeadline(r.reminder_deadline)}</p>
            </div>
          </div>
        </div>
      `).join('')}</div>`;
    }

    function formatDeadline(dateStr) {
      if (!dateStr) return 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      const date = new Date(dateStr);
      return date.toLocaleDateString('ar-EG', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
    }

    // ========== Ø§Ù„Ù…Ù‚Ø±Ø±Ø§Øª Ù…Ø¹ ØµÙˆØ± Ø§Ù„ØºÙ„Ø§Ù ==========
    function renderCourses() {
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            ${courses.map(c => {
              const contentCount = allData.filter(d => d.type === 'content' && d.course_id === c.id).length;
              return `
                <div class="card overflow-hidden cursor-pointer group" onclick="viewCourse('${c.id}')">
                  <div class="relative">
                    <img src="${c.cover}" 
                         alt="${c.name}"
                         class="course-cover"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="course-cover-fallback bg-gradient-to-br from-${c.color}-500 to-${c.color}-700 hidden">
                      <span class="text-5xl group-hover:scale-110 transition-transform">${c.icon}</span>
                    </div>
                    <div class="absolute top-3 left-3 px-3 py-1 glass rounded-full text-white text-xs font-bold">${c.hours} Ø³Ø§Ø¹Ø§Øª</div>
                    <div class="absolute top-3 right-3 px-3 py-1 bg-white/90 rounded-full text-gray-800 text-xs font-bold">${c.code || ''}</div>
                    <div class="absolute bottom-3 right-3 w-12 h-12 bg-white/90 rounded-xl flex items-center justify-center shadow-lg">
                      <span class="text-2xl">${c.icon}</span>
                    </div>
                  </div>
                  <div class="p-5">
                    <h3 class="font-bold text-lg mb-1">${c.name}</h3>
                    <p class="text-sm text-gray-500 mb-3">${c.instructor}</p>
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">${contentCount} Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ§Ø­</span>
                      <button class="px-4 py-2 bg-${c.color}-100 text-${c.color}-700 rounded-lg font-bold text-sm hover:bg-${c.color}-200 transition-all">
                        Ø¹Ø±Ø¶ â†
                      </button>
                    </div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;
    }

    function viewCourse(courseId) {
      const course = courses.find(c => c.id === courseId);
      const content = allData.filter(d => d.type === 'content' && d.course_id === courseId);
      const typeIcons = { video: 'ğŸ¥', pdf: 'ğŸ“„', link: 'ğŸ”—', assignment: 'ğŸ“' };
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <button onclick="showSection('courses')" class="mb-6 text-blue-600 font-bold flex items-center gap-2 hover:gap-3 transition-all">
            â†’ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ù‚Ø±Ø±Ø§Øª
          </button>
          
          <div class="card overflow-hidden mb-6">
            <div class="relative">
              <img src="${course.cover}" 
                   alt="${course.name}"
                   class="w-full h-48 object-cover"
                   onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
              <div class="w-full h-48 bg-gradient-to-br from-${course.color}-500 to-${course.color}-700 hidden items-center justify-center">
                <span class="text-6xl">${course.icon}</span>
              </div>
              <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
              <div class="absolute bottom-4 right-4 left-4 text-white">
                <h1 class="text-2xl font-bold">${course.name}</h1>
                <p class="text-white/80">${course.instructor} â€¢ ${course.code} â€¢ ${course.hours} Ø³Ø§Ø¹Ø§Øª</p>
              </div>
            </div>
          </div>
          
          ${currentUser.role === 'teacher' ? `
            <div class="flex gap-3 mb-6 flex-wrap">
              <button onclick="openModal('addContentModal'); document.getElementById('contentCourse').value='${courseId}'" 
                class="px-6 py-3 btn-primary text-white rounded-xl font-bold flex items-center gap-2">
                â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰
              </button>
            </div>
          ` : ''}
          
          <div class="card p-6">
            <h3 class="font-bold text-xl mb-4">ğŸ“¤ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (${content.length})</h3>
            ${content.length === 0 ? `
              <p class="text-gray-500 text-center py-8">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯</p>
            ` : `
              <div class="space-y-3">
                ${content.map(c => `
                  <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl hover:shadow-lg transition-all">
                    <span class="text-2xl">${typeIcons[c.content_type] || 'ğŸ“'}</span>
                    <div class="flex-1 min-w-0">
                      <p class="font-bold truncate">${c.content_title}</p>
                      <p class="text-xs text-gray-500">${c.content_type}</p>
                    </div>
                    <a href="${c.content_url}" target="_blank" rel="noopener noreferrer" class="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-sm font-bold">ÙØªØ­</a>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    // ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ==========
    function renderContent() {
      const content = allData.filter(d => d.type === 'content');
      const typeIcons = { video: 'ğŸ¥', pdf: 'ğŸ“„', link: 'ğŸ”—', assignment: 'ğŸ“' };
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
            <h2 class="text-xl font-bold">ğŸ“‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (${content.length})</h2>
            <button onclick="openModal('addContentModal'); populateCourses('contentCourse')" 
              class="px-6 py-3 btn-primary text-white rounded-xl font-bold flex items-center gap-2">
              â• Ø¥Ø¶Ø§ÙØ© Ù…Ø­ØªÙˆÙ‰
            </button>
          </div>
          
          ${content.length === 0 ? `
            <div class="card p-12 text-center">
              <span class="text-6xl block mb-4">ğŸ“­</span>
              <p class="text-gray-500 text-lg mb-4">Ù„Ù… ØªÙ‚Ù… Ø¨Ø±ÙØ¹ Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ø¨Ø¹Ø¯</p>
            </div>
          ` : `
            <div class="space-y-4">
              ${content.map(c => {
                const course = courses.find(co => co.id === c.course_id);
                return `
                  <div class="card file-card p-5">
                    <div class="flex items-center gap-5 flex-wrap">
                      <div class="w-14 h-14 bg-${course?.color || 'gray'}-100 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">${typeIcons[c.content_type] || 'ğŸ“'}</span>
                      </div>
                      <div class="flex-1 min-w-[200px]">
                        <h3 class="font-bold text-lg">${c.content_title}</h3>
                        <p class="text-sm text-gray-500">${course?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} â€¢ ${c.content_type}</p>
                      </div>
                      <a href="${c.content_url}" target="_blank" rel="noopener noreferrer" class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-bold">Ù…Ø¹Ø§ÙŠÙ†Ø©</a>
                      <button onclick="deleteContent('${c.__backendId}')" class="px-4 py-2 bg-red-100 text-red-700 rounded-lg font-bold hover:bg-red-200">Ø­Ø°Ù</button>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          `}
        </div>
      `;
    }

    function deleteContent(id) {
      const item = allData.find(d => d.__backendId === id);
      if (!item) return;
      
      deleteRecord(item);
      showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø­ØªÙˆÙ‰', 'âœ…', '');
      renderContent();
    }

    // ========== Ø§Ù„Ø·Ù„Ø§Ø¨ ==========
    function renderStudents() {
      const students = allData.filter(d => d.type === 'user' && d.role === 'student')
        .sort((a, b) => (b.points || 0) - (a.points || 0));
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in space-y-6">
          <div class="card p-6">
            <h2 class="font-bold text-xl mb-4">ğŸ‘¥ Ø§Ù„Ø·Ù„Ø§Ø¨ (${students.length})</h2>
            ${students.length === 0 ? `
              <p class="text-gray-500 text-center py-12">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯</p>
            ` : `
              <div class="space-y-4">
                ${students.map((s, index) => {
                  const isTop3 = index < 3;
                  const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : `#${index + 1}`;
                  
                  return `
                    <div class="member-card p-5 ${isTop3 ? 'bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-amber-200' : 'bg-gray-50'} rounded-2xl">
                      <div class="flex items-center gap-4 flex-wrap">
                        <div class="w-12 h-12 ${isTop3 ? 'bg-gradient-to-br from-amber-400 to-yellow-500 text-white' : 'bg-blue-100'} rounded-xl flex items-center justify-center font-bold text-lg">
                          ${rankIcon}
                        </div>
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl flex items-center justify-center">
                          <span class="text-xl">ğŸ“</span>
                        </div>
                        <div class="flex-1 min-w-[150px]">
                          <p class="font-bold text-lg">${s.name}</p>
                          <p class="text-sm text-gray-500">${s.user_id} â€¢ Ø§Ù„ÙØ±Ù‚Ø© ${getArabicLevel(s.level)}</p>
                        </div>
                        <div class="text-center px-4 py-2 bg-amber-100 rounded-xl">
                          <p class="text-xl font-bold text-amber-700">${(s.points || 0).toLocaleString()}</p>
                          <p class="text-xs text-amber-600">Ù†Ù‚Ø·Ø©</p>
                        </div>
                        <button onclick="openBonusModal('${s.user_id}', '${s.name}')" 
                          class="px-4 py-2 bg-gradient-to-r from-amber-500 to-yellow-500 text-white rounded-xl font-bold text-sm hover:shadow-lg transition-all">
                          â­ Ù…ÙƒØ§ÙØ£Ø©
                        </button>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    // ========== Ø§Ù„Ø¯Ø±Ø¬Ø§Øª ==========
    function renderGrades() {
      const grades = allData.filter(d => d.type === 'grade');
      const gradeTypes = { quiz: 'Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ±', midterm: 'Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„', final: 'Ù†Ù‡Ø§Ø¦ÙŠ', assignment: 'ÙˆØ§Ø¬Ø¨', participation: 'Ù…Ø´Ø§Ø±ÙƒØ©' };
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="card p-6">
            <h2 class="font-bold text-xl mb-6">ğŸ“Š Ø§Ù„Ø¯Ø±Ø¬Ø§Øª (${grades.length})</h2>
            ${grades.length === 0 ? '<p class="text-gray-500 text-center py-12">Ù„Ù… ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯Ø±Ø¬Ø§Øª Ø¨Ø¹Ø¯</p>' : `
              <div class="overflow-x-auto">
                <table class="w-full">
                  <thead>
                    <tr class="bg-gray-50">
                      <th class="p-4 text-right font-bold">Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                      <th class="p-4 text-right font-bold">Ø§Ù„Ù…Ù‚Ø±Ø±</th>
                      <th class="p-4 text-right font-bold">Ø§Ù„Ù†ÙˆØ¹</th>
                      <th class="p-4 text-right font-bold">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${grades.map(g => {
                      const student = allData.find(d => d.type === 'user' && d.user_id === g.user_id);
                      const course = courses.find(c => c.id === g.course_id);
                      return `
                        <tr class="border-t">
                          <td class="p-4 font-bold">${student?.name || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}</td>
                          <td class="p-4">${course?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                          <td class="p-4">${gradeTypes[g.grade_type] || g.grade_type}</td>
                          <td class="p-4">
                            <span class="px-3 py-1 ${g.grade_value >= 70 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'} rounded-full font-bold">
                              ${g.grade_value}%
                            </span>
                          </td>
                        </tr>
                      `;
                    }).join('')}
                  </tbody>
                </table>
              </div>
            `}
          </div>
        </div>
      `;
    }

    function renderMyGrades() {
      const myGrades = allData.filter(d => d.type === 'grade' && d.user_id === currentUser.user_id);
      const gradeTypes = { quiz: 'Ø§Ø®ØªØ¨Ø§Ø± Ù‚ØµÙŠØ±', midterm: 'Ù…Ù†ØªØµÙ Ø§Ù„ÙØµÙ„', final: 'Ù†Ù‡Ø§Ø¦ÙŠ', assignment: 'ÙˆØ§Ø¬Ø¨', participation: 'Ù…Ø´Ø§Ø±ÙƒØ©' };
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="card p-6">
            <h2 class="font-bold text-xl mb-6">ğŸ“Š Ø¯Ø±Ø¬Ø§ØªÙŠ</h2>
            
            ${myGrades.length === 0 ? '<p class="text-gray-500 text-center py-12">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¯Ø±Ø¬Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ø¨Ø¹Ø¯</p>' : `
              <div class="space-y-4">
                ${myGrades.map(g => {
                  const course = courses.find(c => c.id === g.course_id);
                  return `
                    <div class="flex items-center gap-4 p-5 bg-gray-50 rounded-xl flex-wrap">
                      <div class="w-14 h-14 bg-${course?.color || 'gray'}-100 rounded-xl flex items-center justify-center">
                        <span class="text-2xl">${course?.icon || 'ğŸ“Š'}</span>
                      </div>
                      <div class="flex-1 min-w-[200px]">
                        <p class="font-bold text-lg">${course?.name || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p class="text-sm text-gray-500">${gradeTypes[g.grade_type] || g.grade_type}</p>
                      </div>
                      <div class="text-center">
                        <p class="text-4xl font-bold ${g.grade_value >= 70 ? 'text-green-600' : 'text-red-500'}">${g.grade_value}%</p>
                      </div>
                    </div>
                  `;
                }).join('')}
              </div>
            `}
          </div>
        </div>
      `;
    }

    // ========== Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ==========
    let currentQuiz = null;
    let quizIndex = 0;
    let quizScore = 0;

    function renderQuizzes() {
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="card p-6 mb-6">
            <h2 class="font-bold text-xl mb-5">ğŸ“ Ø§Ø®ØªØ± Ù…Ù‚Ø±Ø±Ø§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              ${courses.map(c => {
                const hasQuiz = quizQuestions[c.id];
                return `
                  <button onclick="${hasQuiz ? `startQuiz('${c.id}')` : ''}" 
                    class="p-5 ${hasQuiz ? `bg-${c.color}-100 hover:bg-${c.color}-200 cursor-pointer` : 'bg-gray-100 opacity-50 cursor-not-allowed'} rounded-2xl text-center transition-all">
                    <span class="text-3xl block mb-2">${c.icon}</span>
                    <p class="text-xs font-bold">${c.name.split(' ')[0]}</p>
                    ${!hasQuiz ? '<p class="text-xs text-gray-400 mt-1">Ù‚Ø±ÙŠØ¨Ø§Ù‹</p>' : ''}
                  </button>
                `;
              }).join('')}
            </div>
          </div>
          
          <div class="card p-6">
            <h2 class="font-bold text-xl mb-5">ğŸ“Š Ù†ØªØ§Ø¦Ø¬Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h2>
            ${renderQuizResults()}
          </div>
        </div>
      `;
    }

    function renderQuizResults() {
      const results = allData.filter(d => d.type === 'quiz_result' && d.user_id === currentUser.user_id);
      
      if (results.length === 0) {
        return '<p class="text-gray-500 text-center py-8">Ù„Ù… ØªØ¬Ø± Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª Ø¨Ø¹Ø¯</p>';
      }
      
      return `<div class="space-y-3">${results.map(r => {
        const course = courses.find(c => c.id === r.quiz_course);
        const percentage = Math.round((r.quiz_score / r.quiz_total) * 100);
        return `
          <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-xl">
            <span class="text-3xl">${course?.icon || 'ğŸ“'}</span>
            <div class="flex-1">
              <p class="font-bold">${course?.name || 'Ø§Ø®ØªØ¨Ø§Ø±'}</p>
              <p class="text-sm text-gray-500">${new Date(r.created_at).toLocaleDateString('ar-EG')}</p>
            </div>
            <div class="text-center">
              <p class="text-3xl font-bold ${percentage >= 70 ? 'text-green-600' : 'text-red-500'}">${percentage}%</p>
              <p class="text-xs text-gray-500">${r.quiz_score}/${r.quiz_total}</p>
            </div>
          </div>
        `;
      }).join('')}</div>`;
    }

    function startQuiz(courseId) {
      currentQuiz = { courseId, questions: quizQuestions[courseId] };
      quizIndex = 0;
      quizScore = 0;
      showQuestion();
    }

    function showQuestion() {
      const q = currentQuiz.questions[quizIndex];
      const course = courses.find(c => c.id === currentQuiz.courseId);
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="card p-8 max-w-2xl mx-auto">
            <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
              <h3 class="font-bold text-lg">${course.icon} ${course.name}</h3>
              <span class="px-4 py-2 bg-blue-100 text-blue-700 rounded-full font-bold">
                ${quizIndex + 1} / ${currentQuiz.questions.length}
              </span>
            </div>
            
            <div class="progress-bar h-3 mb-8">
              <div class="progress-fill" style="width: ${((quizIndex + 1) / currentQuiz.questions.length) * 100}%"></div>
            </div>
            
            <p class="text-xl font-bold mb-8 p-5 bg-gray-50 rounded-2xl">${q.q}</p>
            
            <div class="space-y-4" id="quizOptions">
              ${q.options.map((opt, i) => `
                <button onclick="selectAnswer(${i})" class="quiz-option w-full p-5 text-right bg-gray-50 hover:bg-blue-50 border-2 border-gray-200 hover:border-blue-300 rounded-2xl transition-all">
                  <span class="inline-block w-10 h-10 bg-gray-200 rounded-full text-center leading-10 ml-4 font-bold">${['Ø£', 'Ø¨', 'Ø¬', 'Ø¯'][i]}</span>
                  ${opt}
                </button>
              `).join('')}
            </div>
          </div>
        </div>
      `;
    }

    function selectAnswer(index) {
      const q = currentQuiz.questions[quizIndex];
      const options = document.querySelectorAll('.quiz-option');
      
      options.forEach((opt, i) => {
        opt.disabled = true;
        opt.onclick = null;
        if (i === q.correct) opt.classList.add('correct');
        else if (i === index) opt.classList.add('wrong');
      });
      
      if (index === q.correct) quizScore++;
      
      setTimeout(() => {
        quizIndex++;
        if (quizIndex < currentQuiz.questions.length) {
          showQuestion();
        } else {
          endQuiz();
        }
      }, 1500);
    }

    function endQuiz() {
      const percentage = Math.round((quizScore / currentQuiz.questions.length) * 100);
      const course = courses.find(c => c.id === currentQuiz.courseId);
      
      createRecord({
        type: 'quiz_result',
        user_id: currentUser.user_id,
        quiz_course: currentQuiz.courseId,
        quiz_score: quizScore,
        quiz_total: currentQuiz.questions.length,
        created_at: new Date().toISOString()
      });
      
      addPoints(quizScore * 10);
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="card p-10 max-w-md mx-auto text-center">
            <div class="w-32 h-32 mx-auto mb-8 ${percentage >= 70 ? 'bg-green-100' : 'bg-red-100'} rounded-full flex items-center justify-center">
              <span class="text-6xl">${percentage >= 70 ? 'ğŸ‰' : 'ğŸ˜”'}</span>
            </div>
            <h3 class="text-3xl font-bold mb-2">${percentage >= 70 ? 'Ø£Ø­Ø³Ù†Øª!' : 'Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰'}</h3>
            <p class="text-gray-500 mb-8">Ù†ØªÙŠØ¬ØªÙƒ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø± ${course.name}</p>
            
            <div class="text-6xl font-bold ${percentage >= 70 ? 'text-green-600' : 'text-red-500'} mb-8">
              ${percentage}%
            </div>
            
            <div class="flex gap-4 justify-center flex-wrap">
              <button onclick="startQuiz('${currentQuiz.courseId}')" class="px-8 py-4 btn-primary text-white rounded-xl font-bold">
                ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø©
              </button>
              <button onclick="showSection('quizzes')" class="px-8 py-4 bg-gray-200 text-gray-700 rounded-xl font-bold">
                Ø§Ø®ØªØ¨Ø§Ø± Ø¢Ø®Ø±
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // ========== Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª ==========
    function renderAchievements() {
      const earnedBadgeIds = allData.filter(d => d.type === 'badge' && d.user_id === currentUser.user_id).map(b => b.badge_id);
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in space-y-6">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-5">
            <div class="card p-6 text-center bg-gradient-to-br from-amber-50 to-yellow-50 border-2 border-amber-200">
              <span class="text-5xl block mb-3">â­</span>
              <p class="text-4xl font-bold text-amber-600">${(currentUser.points || 0).toLocaleString()}</p>
              <p class="text-gray-500">Ø§Ù„Ù†Ù‚Ø§Ø·</p>
            </div>
            <div class="card p-6 text-center bg-gradient-to-br from-purple-50 to-indigo-50 border-2 border-purple-200">
              <span class="text-5xl block mb-3">ğŸ…</span>
              <p class="text-4xl font-bold text-purple-600">${earnedBadgeIds.length}</p>
              <p class="text-gray-500">Ø§Ù„Ø´Ø§Ø±Ø§Øª</p>
            </div>
            <div class="card p-6 text-center bg-gradient-to-br from-blue-50 to-cyan-50 border-2 border-blue-200">
              <span class="text-5xl block mb-3">ğŸ“Š</span>
              <p class="text-4xl font-bold text-blue-600">${currentUser.xp || 0}</p>
              <p class="text-gray-500">XP</p>
            </div>
            <div class="card p-6 text-center bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200">
              <span class="text-5xl block mb-3">ğŸ¯</span>
              <p class="text-4xl font-bold text-green-600">${Math.floor((currentUser.xp || 0) / 1000) + 1}</p>
              <p class="text-gray-500">Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
            </div>
          </div>
          
          <div class="card p-6">
            <h3 class="font-bold text-xl mb-6">ğŸ… Ø§Ù„Ø´Ø§Ø±Ø§Øª</h3>
            <div class="grid grid-cols-3 md:grid-cols-6 gap-4">
              ${badges.map(b => {
                const earned = earnedBadgeIds.includes(b.id);
                return `
                  <div class="p-5 rounded-2xl text-center ${earned ? 'bg-gradient-to-br from-amber-100 to-yellow-100 border-2 border-amber-300 badge-shine' : 'bg-gray-100 opacity-50'}">
                    <span class="text-4xl block mb-2">${b.icon}</span>
                    <p class="text-sm font-bold">${b.name}</p>
                    <p class="text-xs text-gray-500 mt-1">${b.desc}</p>
                  </div>
                `;
              }).join('')}
            </div>
          </div>
        </div>
      `;
    }

    // ========== Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª ==========
    function renderReminders() {
      const reminders = allData.filter(d => d.type === 'reminder');
      const priorityIcons = { urgent: 'ğŸ”´', today: 'ğŸŸ¡', upcoming: 'ğŸ”µ' };
      const priorityNames = { urgent: 'Ø¹Ø§Ø¬Ù„', today: 'Ù…Ù‡Ù…', upcoming: 'Ø¹Ø§Ø¯ÙŠ' };
      
      document.getElementById('mainContent').innerHTML = `
        <div class="fade-in">
          <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
            <h2 class="text-xl font-bold">â° Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª (${reminders.length})</h2>
            <button onclick="openModal('addReminderModal'); populateCourses('reminderCourse')" 
              class="px-6 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold flex items-center gap-2 hover:shadow-lg">
              â• Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±
            </button>
          </div>
          
          ${reminders.length === 0 ? `
            <div class="card p-12 text-center">
              <span class="text-6xl block mb-4">ğŸ“­</span>
              <p class="text-gray-500 text-lg">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ°ÙƒÙŠØ±Ø§Øª</p>
            </div>
          ` : `
            <div class="space-y-4">
              ${reminders.map(r => {
                const course = courses.find(c => c.id === r.course_id);
                return `
                  <div class="card p-5 reminder-${r.reminder_priority || 'upcoming'}">
                    <div class="flex items-center gap-5 flex-wrap">
                      <span class="text-3xl">${priorityIcons[r.reminder_priority] || 'ğŸ“Œ'}</span>
                      <div class="flex-1 min-w-[200px]">
                        <h3 class="font-bold text-lg">${r.reminder_title}</h3>
                        <p class="text-sm text-gray-500">${course?.name || 'Ø¹Ø§Ù…'} â€¢ ${priorityNames[r.reminder_priority] || 'Ø¹Ø§Ø¯ÙŠ'}</p>
                      </div>
                      <span class="px-4 py-2 bg-blue-100 text-blue-700 rounded-xl text-sm font-bold">
                        ğŸ“… ${formatDeadline(r.reminder_deadline)}
                      </span>
                      <button onclick="deleteReminder('${r.__backendId}')" class="text-red-500 hover:text-red-700">ğŸ—‘ï¸</button>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          `}
        </div>
      `;
    }

    function deleteReminder(id) {
      const item = allData.find(d => d.__backendId === id);
      if (item) {
        deleteRecord(item);
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ°ÙƒÙŠØ±', 'âœ…', '');
        renderReminders();
      }
    }

    // ========== Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ==========
    function populateCourses(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù‚Ø±Ø±</option>' + 
        courses.map(c => `<option value="${c.id}">${c.icon} ${c.name}</option>`).join('');
    }

    function openModal(id) {
      document.getElementById(id).classList.remove('hidden');
      document.getElementById(id).classList.add('flex');
    }

    function closeModal(id) {
      document.getElementById(id).classList.add('hidden');
      document.getElementById(id).classList.remove('flex');
    }

    function openBonusModal(userId, name) {
      document.getElementById('bonusStudentId').value = userId;
      document.getElementById('bonusStudentName').textContent = name;
      openModal('bonusModal');
    }

    function setBonusAmount(amount) {
      document.getElementById('bonusAmount').value = amount;
    }

    function showToast(message, icon = 'âœ…', subMessage = '') {
      const toast = document.getElementById('toast');
      document.getElementById('toastMessage').textContent = message;
      document.getElementById('toastIcon').textContent = icon;
      document.getElementById('toastSubMessage').textContent = subMessage;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // ========== Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ ==========
    document.getElementById('contentForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const newContent = {
        type: 'content',
        course_id: document.getElementById('contentCourse').value,
        content_type: document.getElementById('contentType').value,
        content_title: document.getElementById('contentTitle').value.trim(),
        content_url: document.getElementById('contentUrl').value.trim(),
        content_description: document.getElementById('contentDesc').value.trim(),
        created_by: currentUser.user_id,
        created_at: new Date().toISOString()
      };
      
      createRecord(newContent);
      closeModal('addContentModal');
      this.reset();
      showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­', 'âœ…', '');
      renderContent();
    });

    document.getElementById('reminderForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const newReminder = {
        type: 'reminder',
        reminder_title: document.getElementById('reminderTitle').value.trim(),
        course_id: document.getElementById('reminderCourse').value,
        reminder_deadline: document.getElementById('reminderDeadline').value,
        reminder_priority: document.getElementById('reminderPriority').value,
        reminder_completed: false,
        created_by: currentUser.user_id,
        created_at: new Date().toISOString()
      };
      
      createRecord(newReminder);
      closeModal('addReminderModal');
      this.reset();
      showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ°ÙƒÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'âœ…', '');
      renderReminders();
    });

    document.getElementById('bonusForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const studentId = document.getElementById('bonusStudentId').value;
      const amount = parseInt(document.getElementById('bonusAmount').value);
      const reason = document.getElementById('bonusReason').value;
      
      const student = allData.find(d => d.type === 'user' && d.user_id === studentId);
      if (student) {
        student.points = (student.points || 0) + amount;
        student.xp = (student.xp || 0) + amount;
        updateRecord(student);
        
        showToast(`ØªÙ… Ø¥Ø¶Ø§ÙØ© ${amount} Ù†Ù‚Ø·Ø©`, 'â­', `Ø§Ù„Ø³Ø¨Ø¨: ${reason}`);
      }
      
      closeModal('bonusModal');
      this.reset();
      renderStudents();
    });

    // ========== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==========
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9af2841fd749d821',t:'MTc2NTkzMzU2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>